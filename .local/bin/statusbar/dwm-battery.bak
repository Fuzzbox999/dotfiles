#!/bin/sh

. $HOME/.cache/wal/colors.sh

limit=30

charge() {
	status0=$(cat /sys/class/power_supply/BAT0/status)
        status1=$(cat /sys/class/power_supply/BAT1/status)
        if [ $status1 = "Unknown" ]; then
                 if [ $status0 = "Unknown" ] || [ $status0 = "Charging" ]; then
                         status=""
                 else
                         status=" "
                 fi
         elif [ $status1 = "Charging" ]; then
                 status=""
         elif [ $status1 = "Discharging" ]; then
                 status=" "
         fi
	 if [ $status = "" ]; then
		 bgcolor=""
		 fgcolor=""
	 else
		 bgcolor="^b$foreground^"
		 fgcolor="^c$background^"
	 fi
         echo "$fgcolor$bgcolor $status"
}
 
bat() {
         BAT0_NOW=$(cat /sys/class/power_supply/BAT0/energy_now)
         BAT0_FULL=$(cat /sys/class/power_supply/BAT0/energy_full)
         BAT1_NOW=$(cat /sys/class/power_supply/BAT1/energy_now)
         BAT1_FULL=$(cat /sys/class/power_supply/BAT1/energy_full)
         BAT0_PERCENT=$((($BAT0_NOW)*100/$BAT0_FULL))
         BAT1_PERCENT=$((($BAT1_NOW)*100/$BAT1_FULL))
         BAT_TOT=$((($BAT0_NOW+$BAT1_NOW)*100/($BAT0_FULL+$BAT1_FULL)))
	 if [ "$BAT_TOT" -lt $limit ]; then
		color="^c#ff0000^"
	 	endcolor="^d^"
	else
		color=""
		endcolor="^d^"
	 fi
         # echo "$color$BAT_TOT% ($BAT0_PERCENT-$BAT1_PERCENT) $endcolor"
 	 echo "$color$BAT_TOT% $endcolor"
}

echo "$(charge) $(bat)"
