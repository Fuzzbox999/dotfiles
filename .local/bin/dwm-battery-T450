#!/bin/sh

. $HOME/.cache/wal/colors.sh

limit=30
endcolor="^d^"

battery() {
	read status0 < /sys/class/power_supply/BAT0/status
	read status1 < /sys/class/power_supply/BAT1/status

	read BAT0_NOW < /sys/class/power_supply/BAT0/energy_now
	read BAT0_FULL < /sys/class/power_supply/BAT0/energy_full
	read BAT1_NOW < /sys/class/power_supply/BAT1/energy_now
	read BAT1_FULL < /sys/class/power_supply/BAT1/energy_full

	BAT_TOT=$((($BAT0_NOW+$BAT1_NOW)*100/($BAT0_FULL+$BAT1_FULL)))
	# is it on AC or on battery ?
	if [ $status1 = "Unknown" ]; then
		if [ $status0 = "Unknown" ] || [ $status0 = "Charging" ]; then
			status=""
		else
			status=" "
		fi
	elif [ $status1 = "Charging" ]; then
		status=""
        elif [ $status1 = "Discharging" ]; then
        	status=" "
        fi
	# Different colors if on AC / on battery / on < 30% battery
	if [ $status = "" ]; then
		echo " $status $BAT_TOT% ^d^"
	else
		if [ "$BAT_TOT" -lt $limit ]; then
			echo "^c$background^^b#ff0000^ $status $BAT_TOT% ^d^"
		else
			echo "^c$background^^b$foreground^ $status $BAT_TOT% ^d^"
		fi

	fi
}

echo "$(battery)"

