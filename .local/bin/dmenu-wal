#!/bin/sh

. "$HOME/.cache/wal/colors.sh"

dmenufont="SFNS Display:style=Regular:size=11"

theme=$(echo -e "Dark\nLight"| dmenu -c -fn "$dmenufont" -nb "$color0" -nf "$color7" -sb "$color10" -sf "$color0" -h 32 -bw 1 -c -l 2)

if   [ "$theme" == "Dark" ]; then
	wal_arg=""
	walwpg="false"
	wpg_arg=""
elif [ "$theme" == "Light" ]; then
	wal_arg="-l"
	walwpg="true"
	wpg_arg="--light"
else
	exit 0
fi

if [ -z "$theme" ]; then
	exit 0
else
	true
fi

backend=$(echo -e "wal\ncolorz\nhaishoku\ncolorthief\nschemer2"| dmenu -c -fn "$dmenufont" -nb "$color0" -nf "$color7" -sb "$color10" -sf "$color0" -h 32 -bw 1 -c -l 5)

wal --backend $backend $wal_arg -i $1

sed -i"" \
	-e "s/backend = .*/backend = $backend/" \
	-e "s/light_theme = .*/light_theme = $walwpg/" \
	"$HOME/.config/wpg/wpg.conf"

wpg -a $1
wpg $wpg_arg --backend $backend -n -s $1
wal -R
cp $1 ~/Images/Current/wall.jpg
sassc /home/fuzzbox/.startpage/scss/style.scss /home/fuzzbox/.startpage/style.css

sed -i"" --follow-symlinks \
        -e "s/frame_color = .*/frame_color = \"${color7:-#FFFFFF}\"/" \
	-e "s/foreground = .*/foreground = \"${color7:-#FFFFFF}\"/" \
	-e "s/background = .*/background = \"${color0:-#FFFFFF}\"/" \
	"${HOME}/.config/dunst/dunstrc"


rm /home/fuzzbox/.suckless/dwm/config.h
cd /home/fuzzbox/.suckless/dwm/ && make

kill -HUP $(pidof dwm)

pkill dunst
dunst -config ~/.config/dunst/dunstrc &

